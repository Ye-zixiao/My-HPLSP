#include "MyUNP.h"#include <sys/sem.h>union semun {	int val;	struct semid_ds* ds_buf;	unsigned short* array;	struct seminfo* _buf;};int pv(int sem_id, int op) {	struct sembuf sbuf;	sbuf.sem_num = 0;	sbuf.sem_op = op;	sbuf.sem_flg = SEM_UNDO;	return semop(sem_id, &sbuf, 1);}int main(int argc, char* argv[]){	union semun sem_un;	int sem_id;	pid_t pid;	if ((sem_id = semget(IPC_PRIVATE, 1, 0666)) == -1)		err_sys("semget error");#define DEBUG#ifdef DEBUG	printf("semid: %d\n", sem_id);#endif // DEBUG		sem_un.val = 1;	if (semctl(sem_id, 0, SETVAL, sem_un) == -1)		err_sys("semctl error");	if ((pid = fork()) < 0)		err_sys("fork error");	else if (pid == 0) {		printf("child try to get binary sem\n");		if (pv(sem_id, -1) == -1)			err_sys("pv error");		printf("child get sem and will release it after 5 seconds\n");		sleep(5);		if (pv(sem_id, 1) == -1)			err_sys("pv error");		exit(EXIT_SUCCESS);	}	else {		printf("parent try to get binary sem\n");		if (pv(sem_id, -1) == -1)			err_sys("pv error");		printf("parent get sem and will release it after 5 seconds\n");		sleep(5);		if (pv(sem_id, 1) == -1)			err_sys("pv error");	}	if (waitpid(pid, NULL, 0) != pid)		err_sys("waitpid error");	if (semctl(sem_id, 0, IPC_RMID) == -1)		err_sys("semctl error");	exit(EXIT_SUCCESS);}